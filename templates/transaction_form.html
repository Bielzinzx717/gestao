{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow">
      <div class="card-header bg-primary text-white">
        <!-- Adicionando Ã­cones ao tÃ­tulo -->
        <h4 class="mb-0">
          {% if transacao %}
            <i class="fas fa-edit me-2"></i>Editar TransaÃ§Ã£o
          {% else %}
            <i class="fas fa-plus-circle me-2"></i>Nova TransaÃ§Ã£o
          {% endif %}
        </h4>
      </div>
      <div class="card-body p-4">
        <form method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          
          <div class="mb-3">
            <label for="descricao" class="form-label"><i class="fas fa-file-alt me-2"></i>DescriÃ§Ã£o</label>
            <input type="text" class="form-control" id="descricao" name="descricao" 
                   placeholder="Ex: Compra no supermercado"
                   value="{{ transacao.descricao if transacao else '' }}" required minlength="2" maxlength="200">
          </div>

          <div class="mb-3">
            <label for="valor" class="form-label"><i class="fas fa-dollar-sign me-2"></i>Valor (R$)</label>
            <input type="number" step="0.01" class="form-control" id="valor" name="valor" 
                   placeholder="0.00"
                   value="{{ transacao.valor if transacao else '' }}" required min="0.01" max="999999999">
          </div>

          <div class="mb-3">
            <label for="tipo" class="form-label"><i class="fas fa-exchange-alt me-2"></i>Tipo</label>
            <select class="form-select" id="tipo" name="tipo" required>
              <option value="receita" {% if transacao and transacao.tipo == 'receita' %}selected{% endif %}>
                <i class="fas fa-arrow-up"></i> Receita
              </option>
              <option value="despesa" {% if transacao and transacao.tipo == 'despesa' %}selected{% endif %}>
                <i class="fas fa-arrow-down"></i> Despesa
              </option>
            </select>
          </div>

          <div class="mb-3">
            <label for="categoria" class="form-label"><i class="fas fa-tags me-2"></i>Categoria</label>
            <select class="form-select" id="categoria_select" name="categoria" onchange="toggleCategoriaCustomizada()">
              <option value="">Selecione uma categoria</option>
              <optgroup label="Despesas">
                <option value="AlimentaÃ§Ã£o" {% if transacao and transacao.categoria == 'AlimentaÃ§Ã£o' %}selected{% endif %}>ğŸ½ï¸ AlimentaÃ§Ã£o</option>
                <option value="Transporte" {% if transacao and transacao.categoria == 'Transporte' %}selected{% endif %}>ğŸš— Transporte</option>
                <option value="SaÃºde" {% if transacao and transacao.categoria == 'SaÃºde' %}selected{% endif %}>â¤ï¸ SaÃºde</option>
                <option value="EducaÃ§Ã£o" {% if transacao and transacao.categoria == 'EducaÃ§Ã£o' %}selected{% endif %}>ğŸ“ EducaÃ§Ã£o</option>
                <option value="Moradia" {% if transacao and transacao.categoria == 'Moradia' %}selected{% endif %}>ğŸ  Moradia</option>
                <option value="Lazer" {% if transacao and transacao.categoria == 'Lazer' %}selected{% endif %}>ğŸ® Lazer</option>
                <option value="VestuÃ¡rio" {% if transacao and transacao.categoria == 'VestuÃ¡rio' %}selected{% endif %}>ğŸ‘” VestuÃ¡rio</option>
                <option value="Contas" {% if transacao and transacao.categoria == 'Contas' %}selected{% endif %}>ğŸ“„ Contas</option>
              </optgroup>
              <optgroup label="Receitas">
                <option value="SalÃ¡rio" {% if transacao and transacao.categoria == 'SalÃ¡rio' %}selected{% endif %}>ğŸ’° SalÃ¡rio</option>
                <option value="Freelance" {% if transacao and transacao.categoria == 'Freelance' %}selected{% endif %}>ğŸ’¼ Freelance</option>
                <option value="Investimentos" {% if transacao and transacao.categoria == 'Investimentos' %}selected{% endif %}>ğŸ“ˆ Investimentos</option>
                <option value="Vendas" {% if transacao and transacao.categoria == 'Vendas' %}selected{% endif %}>ğŸ›’ Vendas</option>
                <option value="BÃ´nus" {% if transacao and transacao.categoria == 'BÃ´nus' %}selected{% endif %}>ğŸ BÃ´nus</option>
              </optgroup>
              <option value="outra">âœï¸ Outra (personalizada)</option>
            </select>
          </div>

          <div class="mb-3" id="categoria_customizada_div" style="display: none;">
            <label for="categoria_customizada" class="form-label"><i class="fas fa-pen me-2"></i>Digite a categoria personalizada</label>
            <input type="text" class="form-control" id="categoria_customizada" placeholder="Ex: Pets, DoaÃ§Ãµes, etc." maxlength="50">
          </div>

          <div class="mb-3">
            <label for="data" class="form-label"><i class="fas fa-calendar-alt me-2"></i>Data</label>
            <input type="date" class="form-control" id="data" name="data" 
                   value="{{ transacao.data.strftime('%Y-%m-%d') if transacao else '' }}" required>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary flex-grow-1">
              {% if transacao %}
                <i class="fas fa-save me-2"></i>Atualizar
              {% else %}
                <i class="fas fa-plus me-2"></i>Adicionar
              {% endif %}
            </button>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
              <i class="fas fa-times me-2"></i>Cancelar
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  window.addEventListener('DOMContentLoaded', function() {
    const categoriaAtual = "{{ transacao.categoria if transacao else '' }}";
    const categoriaSelect = document.getElementById('categoria_select');
    const opcoesPredefinidas = Array.from(categoriaSelect.options).map(opt => opt.value);
    
    if (categoriaAtual && !opcoesPredefinidas.includes(categoriaAtual)) {
      categoriaSelect.value = 'outra';
      document.getElementById('categoria_customizada_div').style.display = 'block';
      document.getElementById('categoria_customizada').value = categoriaAtual;
    }
  });

  function toggleCategoriaCustomizada() {
    const select = document.getElementById('categoria_select');
    const customDiv = document.getElementById('categoria_customizada_div');
    const customInput = document.getElementById('categoria_customizada');
    
    if (select.value === 'outra') {
      customDiv.style.display = 'block';
      customInput.required = true;
      customInput.focus();
    } else {
      customDiv.style.display = 'none';
      customInput.required = false;
      customInput.value = '';
    }
  }

  document.querySelector('form').addEventListener('submit', function(e) {
    const select = document.getElementById('categoria_select');
    const customInput = document.getElementById('categoria_customizada');
    
    if (select.value === 'outra' && customInput.value.trim()) {
      const hiddenInput = document.createElement('input');
      hiddenInput.type = 'hidden';
      hiddenInput.name = 'categoria';
      hiddenInput.value = customInput.value.trim();
      this.appendChild(hiddenInput);
      
      select.removeAttribute('name');
    }
  });
</script>
{% endblock %}